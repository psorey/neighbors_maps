<!DOCTYPE html>
<html>
<head>
  <title>NeighborsMaps</title>
  <link href="/assets/application.css?body=1" media="screen" rel="stylesheet" />
<link href="/assets/neighbors_maps.css?body=1" media="screen" rel="stylesheet" />
  <script src="/assets/jquery.js?body=1"></script>
<script src="/assets/jquery_ujs.js?body=1"></script>
<script src="/assets/openlayers/OpenLayers.js?body=1"></script>
<script src="/assets/openlayers-rails.js?body=1"></script>
<script src="/assets/neighbors_maps.js?body=1"></script>
<script src="/assets/theme_maps.js?body=1"></script>
<script src="/assets/application.js?body=1"></script>
  <meta content="authenticity_token" name="csrf-param" />
<meta content="I1o0ol8aaI5YiGWiVAI3sbwAf7xB/Sae/Sc7vjzfVg4=" name="csrf-token" />
</head>

<!-- --- begin /layouts/theme_maps.html.erb --------  -->  
<body>
  <div id="container">
    <div class="sidebar">
      <div id="side_menu">
        <a href="/">Home</a><br /><br />
        <a href="/theme_maps">GIS Data Maps</a><br /><br />

      </div>
    </div>

    <style type="text/css">
      .content { padding: 10px; }  /* get rid of extra padding so map can be larger... */
    </style>

    <!-- --- end /layouts/theme_maps.html.erb -------- --> 
        <!-- begin layouts/content ------------------------------------ -->
    
    <div class="content">
 
      <script defer="defer" type="text/javascript">

  var exist_features = [];
  var exist_geometries = [];
  var exist_labels = [];
  var map, drawControls, walking_paths_survey, walking_paths_survey_labels;
  function init() {
    map = new OpenLayers.Map('map', {maxExtent: new OpenLayers.Bounds(1259300,253000,1269500,263500)});
  </script>
    <script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var aerial_high_res = new OpenLayers.Layer.WMS('Aerial High Res',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'aerial_high_res',
          format: 'png',
          transparent: 'false'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:true,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var parcel_outlines = new OpenLayers.Layer.WMS('Parcel Outlines',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'parcel_outlines',
          format: 'png',
          transparent: 'true'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:false,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var neighbors = new OpenLayers.Layer.WMS('Neighbors',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'neighbors',
          format: 'png',
          transparent: 'true'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:false,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var none = new OpenLayers.Layer.WMS('None',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'none',
          format: 'png',
          transparent: 'false'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:true,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var parcels = new OpenLayers.Layer.WMS('Parcels',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'parcels',
          format: 'png',
          transparent: 'true'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:false,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var parks = new OpenLayers.Layer.WMS('Parks',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'parks',
          format: 'png',
          transparent: 'true'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:false,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var project_boundary = new OpenLayers.Layer.WMS('Project Boundary',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'project_boundary',
          format: 'png',
          transparent: 'true'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:false,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>
<script type="text/javascript">
    ///// begin map_layers //////////////////////////////////////////////////     
      
      var street_names = new OpenLayers.Layer.WMS('Street Names',
      'http://localhost/cgi-bin/mapserv?map=/home/paul/mapserver/walking_paths_survey.map',
        { layers: 'street_names',
          format: 'png',
          transparent: 'true'},
        { 
          //scales: [100,200,400,800,1600,3200,6400,12800,25600,51200],
          scales: [100,200,300,400,500,600,800,1000,1200,1500,2000,4000,8000,12000,18000,24000,32000,48000,56000],
          units: 'm',
          projection:new OpenLayers.Projection("epsg:4326"),
          gutter:0,
          ratio:1,
          isBaselayer:false,
          singleTile:true,
        }
      );
     
      ///// end map_layers ////////////////////////////////////////////////// 
</script>

      <script type="text/javascript">

     //// begin open_layers_init ////////////////////////////

      map.addLayers([none,aerial_high_res,parcels,parks,parcel_outlines,project_boundary,street_names,neighbors]);

      map.addControl(new OpenLayers.Control.Scale('scale'));
      map.addControl(new OpenLayers.Control.MousePosition());
      var layerSwitch = new OpenLayers.Control.LayerSwitcher();
      map.addControl(layerSwitch);
      layerSwitch.maximizeControl();
      map.zoomToMaxExtent();      
      
      //// end open_layers_init ////////////////////////////////
</script>

        
<script type="text/javascript">
     /////// begin open_layers_interactive_init /////////////////////////

      
      var prompt_title = 'enter a number'
      var prompt_string = 'estimated trips per month'
      
      exist_geometries = [&quot;LineString (1263367.98393814 258338.827844252, 1264461.94723633 258311.170081408, 1265595.42162429 258289.156759961, 1265606.35772949 258964.514173047, 1265607.94522862 259294.078995083, 1265615.88272434 259604.593827405, 1266976.1931009 259562.26051693, 1267010.0597492 260053.32691842)&quot;,&quot;LineString (1263352.4617243 258190.6612576, 1263335.5284001 257682.66153192, 1264613.99437639 257644.561552492, 1264605.52771431 257587.411583351, 1264677.49434211 257580.003254017, 1264635.16103164 256277.195624199)&quot;,&quot;LineString (1263367.98393814 258355.761168446, 1263369.3950485 259172.79406058, 1264232.9945822 259833.19370396, 1263962.0613952 260121.06021518)&quot;,&quot;LineString (1265641.5299089 259578.52433982, 1268308.5284687 259539.01325004)&quot;,&quot;LineString (1267001.5930871 262203.85909048, 1266950.7931145 259223.59403315)&quot;];
      exist_labels = [&quot;5&quot;,&quot;3&quot;,&quot;7&quot;,&quot;20&quot;,&quot;6&quot;];
      console.log("json geometries:");
      console.log(@json_geometries);
      OpenLayers.Feature.Vector.style['default']['strokeWidth'] = '4';
      OpenLayers.Feature.Vector.style['temporary']['strokeWidth'] = '4';
      OpenLayers.Feature.Vector.style['default']['strokeColor'] = '#ff0000';
      OpenLayers.Feature.Vector.style['temporary']['strokeColor'] = '#ff7777';
      OpenLayers.Feature.Vector.style['select']['strokeWidth'] = '4';
      OpenLayers.Feature.Vector.style['select']['strokeColor'] = '#3300ff';
      
      walking_paths_survey = new OpenLayers.Layer.Vector("Walking Paths Survey",
         { projection: new OpenLayers.Projection("epsg:4326"),
           opacity:0.5,
           rendererOptions: {zIndexing: true}
      } );
      
      walking_paths_survey_labels = new OpenLayers.Layer.Vector("Walking Paths Survey Labels",
      { projection: new OpenLayers.Projection("epsg:4326"),
        opacity:0.5,
        styleMap: new OpenLayers.StyleMap({'default':{
          strokeColor: "#ff0000",
          strokeOpacity: .8,
          strokeWidth: 3,
          fillColor: "#FFeeee",
          fillOpacity: 1,
          pointRadius: 12,
          pointerEvents: "visiblePainted",
          label : "${geometry_feature_attribute}",
              
          fontColor: "black",
          fontSize: "20px",
          fontFamily: "Courier New, monospace",
          fontWeight: "bold",
          labelAlign: "cm",
          graphicZIndex: 100,
          labelXOffset: "0",
          labelYOffset: "0"
        }}),
        rendererOptions: {zIndexing: true}
      });
      walking_paths_survey.setZIndex(2);
      walking_paths_survey_labels.setZIndex(1);
      
      map.addLayers([walking_paths_survey, walking_paths_survey_labels]);

       
      /// ----------- callback functions ------------------///
      
      walking_paths_survey_labels.events.register('featureadded', this, function(obj){
          console.log ("label feature added");
          if(obj.feature.attributes.geometry_feature_attribute == null)
          {
              obj.feature.destroy;
              obj.feature.state = OpenLayers.State.DELETE;
          }
      });
      
      walking_paths_survey.events.register('featuresadded', this, function(obj){
          for(i = 0; i < obj.features.length; i = i + 1)
          {
              geometry_feature = obj.features[i];
              if(geometry_feature.attributes.geometry_feature_attribute == null)
              {
                  var geometry_feature_attribute = prompt(prompt_title, prompt_string);
                  geometry_feature.attributes.geometry_feature_attribute = geometry_feature_attribute;
                  if (geometry_feature.attributes.geometry_feature_attribute == null)
                  {
                      geometry_feature.state = OpenLayers.State.DELETE;
                  }
              }
          };
          console.log ("featuresadded");
          makeLabeledDots(walking_paths_survey, walking_paths_survey_labels); 
      } );
      
      // update the label layer after editing the lines...
      walking_paths_survey.events.register('afterfeaturemodified', this, function(obj){
          makeLabeledDots(walking_paths_survey, walking_paths_survey_labels);
      } );
    
      var deleteFeature = function(feature) {   // SelectFeature callback function
          select.unselectAll();
         walking_paths_survey.destroyFeatures(feature);
          walking_paths_survey.selectedFeatures = [];
          makeLabeledDots(walking_paths_survey, walking_paths_survey_labels);
      };
       
      var select = new OpenLayers.Control.SelectFeature(walking_paths_survey, {
          onSelect: deleteFeature,  // calls deleteFeature(selected_feature)
          clickout: true
      } );

      /// ----------- add controls for interaction ------------------ ///
      
      drawControls = {
          line: new OpenLayers.Control.DrawFeature(walking_paths_survey,
                      OpenLayers.Handler.Path),
          modify: new OpenLayers.Control.ModifyFeature(walking_paths_survey),
          select: select  // for deleting lines
      };
      
      for(var key in drawControls) {
          map.addControl(drawControls[key]);
      };
            
      // now add the geometries and label strings from the database-loaded arrays...
      buildFeatures(); // using exist_geometries[] and exist_labels[]

     // document.getElementById('noneToggle').checked = true;
      
     ///// end open_layers_interactive_init /////////////////////////////////
   </script>   

      <script type="text/javascript">
      }  // end of init()

  window.onload=init;

</script>

  <script type="text/javascript">     
     ///// begin open_layers_interactive_functions ////////////////////////////////
    
      function emptyFeatures(){
        walking_paths_survey.destroyFeatures();
        walking_paths_survey_labels.destroyFeatures();
        exist_geometries = [];
        exist_labels = [];
        exist_features = [];
      }
      
      function buildFeatures(){
        geometries = [];
        geometry_labels = [];
        for(i=0; i < exist_geometries.length; i = i + 1)
        {
          var geom = new OpenLayers.Geometry.fromWKT(exist_geometries[i]);
          feature = new OpenLayers.Feature.Vector(geom, {geometry_feature_attribute: exist_labels[i]});
          exist_features[i] = feature;
        };
       // this triggers the makeLabeledDots function through the 'featuresadded' event callback      
        walking_paths_survey.addFeatures(exist_features);
      }
      
      
      function toggleControl(element) {
        for(key in drawControls) {
          var control = drawControls[key];
          if(element.value == key && element.checked) {
            control.activate();
          } else {
            control.deactivate();
          }
        }
        makeLabeledDots(walking_paths_survey, walking_paths_survey_labels);
      }
     

      var geometries = [];
      var geometry_labels = [];
       
      function makeLabeledDots(geom_layer, label_layer) {
        var lineFeatures = geom_layer.features; //returns: {Array(OpenLayers.Feature.Vector)}               
        label_layer.destroyFeatures();
        geometries = [];
        geometry_labels = [];
        for (var i = 0; i < lineFeatures.length; i = i+1) {       
          if (lineFeatures[i] != null) {                  
            var geometry = lineFeatures[i].geometry;
            var nodes = lineFeatures[i].geometry.getVertices();
            var lastNode = nodes[nodes.length -1];
            var pointFeature = new OpenLayers.Feature.Vector(lastNode);
            var count = i + '';
            pointFeature.attributes = {
                    geometry_feature_attribute: lineFeatures[i].attributes.geometry_feature_attribute,
                    whichLine: count};
            label_layer.addFeatures(pointFeature);
            var wktwriter=new OpenLayers.Format.WKT();
            var wkt=wktwriter.write(lineFeatures[i]);
            geometries.push(wkt);
            geometry_labels.push(lineFeatures[i].attributes.geometry_feature_attribute);
          }
        }
      }
       
     ///// end open_layers_interactive_functions ////////////////////////////////      
   </script>



</script>

<div id="map" class="smallmap"></div>
<h2 id="title">Walking Paths Survey </h2>

  <!--  begin draw_controls ////////////////////////////////////////////////// -->   
<div id='my_notice' ></div>

  <div class='map_draw_controls'>  
    <ul id="controlToggle">
      <li class='border_top_thin'>
        <input type="radio" name="type" value="none" id="noneToggle"
        onclick="toggleControl(this);" checked="checked" />
        <label for="noneToggle">navigate</label>
      </li>
      <li>
        <input type="radio" name="type" value="line" id="lineToggle" onclick="toggleControl(this);" />
        <label for="lineToggle">draw a line<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end: dbl-clck</label>
      </li>
      <li>
        <input type="radio" name="type" value="modify" id="modifyToggle"
        onclick="toggleControl(this);" onchange="update();" />
        <label for="modifyToggle">modify a line</label>
      </li>
      <li>
        <input type="radio" name="type" value="select" id="selectToggle"
        onclick="toggleControl(this);" onchange="update();" />
        <label for="selectToggle">delete a line</label>
      </li>
    </ul>
    <input onclick="revertSaved();" style="width: 100px; margin-left: 15px;" type="button" value="revert" />
    <input onclick="saveChanges();" style="width: 100px; margin-left: 15px;" type="button" value="save changes" />
    <div style="height: 30px; width: 120px;">
      <div id="indicator" style="display: none; height: 20px; text-align: center;" >Edits Saved</div>
    </div>
    <input onclick="showHelp();" style="width: 100px; margin-left: 15px;" type="button" value="help" />

  </div>

<!--  end draw_controls ////////////////////////////////////////////////// --> 


<div>
  <a href="/theme_maps/walking-paths-survey/edit">Edit</a>


</div>

      <br />
      <br />
      <br />
    </div>

    <div id="footer" style="height: 15px; padding-top:6px; font-size: 9px; font-weight: lighter; color: #222;">
      ...website by <a href="http://paulsorey.com" style="font-size: 9px; font-weight: lighter;">paulsorey.com</a>...
    </div>
    
    <!-- Start of StatCounter Code -->
      <script type="text/javascript">
      var sc_project=7003450; 
      var sc_invisible=1; 
      var sc_security="aa94c436"; 
      </script>
      <script type="text/javascript"
      src="http://www.statcounter.com/counter/counter.js"></script>
      <noscript><div class="statcounter"><a title="tumblr hit counter"
      href="http://statcounter.com/tumblr/" target="_blank"><img
      class="statcounter" src="http://c.statcounter.com/7003450/0/aa94c436/1/"
      alt="tumblr hit counter"></a></div></noscript>
    <!-- End of StatCounter Code -->
   
  </div>
</body>
</html>
<!-- end layouts/content ------------------------------------ -->     


