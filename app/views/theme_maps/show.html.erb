
  <script defer="defer" type="text/javascript">
    var map, drawControls, <%=@theme_map.name.dashed%>, <%=@theme_map.name.dashed + '_labels'%>;
    function init() {
      map = new OpenLayers.Map('map', {maxExtent: new OpenLayers.Bounds(1259300,253000,1269500,263500)});
      <%= render :partial => 'map_layers', :collection => @theme_map.theme_map_layers, :as => :tml  %>
      <%= render :partial => 'open_layers_init' %>
<% if @theme_map.is_interactive %>
      <%= render :partial => 'open_layers_interactive_init' %>
<% end %>
    }  // end of init()

<% if @theme_map.is_interactive %>
       <%= render :partial => 'open_layers_interactive_functions' %>
<% end %>

  window.onload=init;  
  </script>
  
  <div id="map" class="smallmap"></div>
  <h2 id="title"><%=h @theme_map.name %> </h2>
  
<script type='text/javascript'>

  function saveChanges(){
    new Ajax.Request("/theme_maps/<%=@theme_map.name.dashed%>/update_geo_db", {
      // method: 'put',
      parameters: {
        id: '<%=@theme_map.name.dashed%>',
        contentType: 'text/javascript',
        //labels: geometry_labels.flatten(),
        //geometries: geometries.flatten()
        
        labels: JSON.stringify(geometry_labels),
        geometries: JSON.stringify(geometries)
        //labels: geometry_labels.toString(),
        //geometries: geometries.toString()
      },
      //onSuccess: showResponse,
      //onFailure: showError
    });
  }
  
</script>

<% if @theme_map.is_interactive %>
      <%= render :partial => 'draw_controls' %>
      <%= button_to_function "save changes", "saveChanges()" %>
<% end %>



<% if current_user && current_user.roles[0].name  == "admin" %>
  <%= link_to 'Edit', edit_theme_map_path(@theme_map) %> |

<% end %>
  <%= link_to 'Back', theme_maps_path %>
